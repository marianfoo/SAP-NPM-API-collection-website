{"version":3,"file":"QueryControl.js","names":["QueryControl","constructor","view","liveSearch","event","value","getParameter","trim","getModel","setProperty","applySearchFilter","getProperty","valueTypes","list","byId","listBinding","getBinding","nameFilter","Filter","path","operator","FilterOperator","Contains","value1","descFilter","tagsFilter","array","valueType","includes","key","type","bind","typeFilters","i","length","typeFilter","push","filters","and","typesTagsFilter","searchFilter","filter","onUpdateToken","model","tokenArray","addOrRemove","keyArray","split","tokenObject","obj"],"sources":["../../src/controller/QueryControl.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\nimport Event from \"sap/ui/base/Event\";\nimport View from \"sap/ui/core/mvc/View\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport ListBinding from \"sap/ui/model/ListBinding\";\n\nexport default class QueryControl {\n\tprivate view: View;\n\n\t// create constructor\n\tconstructor(view: View) {\n\t\tthis.view = view;\n\t}\n\n\tpublic liveSearch(event: Event): void {\n\t\tconst value = event.getParameter(\"value\").trim();\n\t\t(this.view.getModel(\"settings\") as JSONModel).setProperty(\"/search\", value);\n\t\tthis.applySearchFilter();\n\t}\n\n\tpublic applySearchFilter(): void {\n\t\tlet value = this.view.getModel(\"settings\").getProperty(\"/search\");\n\t\tconst valueTypes = this.view.getModel(\"settings\").getProperty(\"/tokens\");\n\t\tif (!value) {\n\t\t\tvalue = \"\";\n\t\t}\n\t\tconst list = this.view.byId(\"listAllPackages\");\n\t\tconst listBinding = list.getBinding(\"items\") as ListBinding;\n\t\tconst nameFilter = new Filter({\n\t\t\tpath: \"name\",\n\t\t\toperator: FilterOperator.Contains,\n\t\t\tvalue1: value,\n\t\t});\n\t\tconst descFilter = new Filter({\n\t\t\tpath: \"description\",\n\t\t\toperator: FilterOperator.Contains,\n\t\t\tvalue1: value,\n\t\t});\n\t\tconst tagsFilter = new Filter(\n\t\t\t\"tags\",\n\t\t\tfunction (array: Array<any>) {\n\t\t\t\tfor (const valueType of valueTypes) {\n\t\t\t\t\tif (array.includes(valueType.key) && valueType.type === \"tag\") {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t);\n\t\tconst typeFilters = [];\n\t\tfor (let i = 0; i < valueTypes.length; i++) {\n\t\t\tconst typeFilter = new Filter({\n\t\t\t\tpath: \"type\",\n\t\t\t\toperator: FilterOperator.Contains,\n\t\t\t\tvalue1: valueTypes[i].key,\n\t\t\t});\n\t\t\ttypeFilters.push(typeFilter);\n\t\t}\n\t\tconst typeFilter = new Filter({\n\t\t\tfilters: typeFilters,\n\t\t\tand: true,\n\t\t});\n\t\tconst typesTagsFilter = new Filter({\n\t\t\tfilters: [tagsFilter, typeFilter],\n\t\t\tand: false,\n\t\t});\n\t\tconst searchFilter = new Filter({\n\t\t\tfilters: [nameFilter, descFilter],\n\t\t\tand: false,\n\t\t});\n\t\tif (valueTypes.length > 0) {\n\t\t\tlistBinding.filter(\n\t\t\t\tnew Filter({\n\t\t\t\t\tfilters: [searchFilter, typesTagsFilter],\n\t\t\t\t\tand: true,\n\t\t\t\t})\n\t\t\t);\n\t\t} else {\n\t\t\tlistBinding.filter(searchFilter);\n\t\t}\n\t}\n\n\tpublic onUpdateToken(event: Event): void {\n\t\tconst model = this.view.getModel(\"settings\");\n\t\tlet tokenArray = model.getProperty(\"/tokens\");\n\n\t\tconst addOrRemove = event.getParameter(\"type\");\n\t\tif (addOrRemove === \"added\") {\n\t\t\tconst keyArray = event.getParameter(\"addedTokens\")[0].getProperty(\"key\").split(\";\");\n\t\t\tconst tokenObject = {\n\t\t\t\tkey: keyArray[0],\n\t\t\t\ttype: keyArray[1],\n\t\t\t};\n\t\t\ttokenArray.push(tokenObject);\n\t\t} else if (addOrRemove === \"removed\") {\n\t\t\tconst keyArray = event.getParameter(\"removedTokens\")[0].getProperty(\"key\").split(\";\");\n\t\t\tconst tokenObject = {\n\t\t\t\tkey: keyArray[0],\n\t\t\t\ttype: keyArray[1],\n\t\t\t};\n\t\t\t// filter token object array with key and type values\n\t\t\ttokenArray = tokenArray.filter(function (obj) {\n\t\t\t\treturn obj.key !== tokenObject.key && obj.type !== tokenObject.type;\n\t\t\t});\n\t\t}\n\t\t(this.view.getModel(\"settings\") as JSONModel).setProperty(\"/tokens\", tokenArray);\n\t\t// this.applySearchFilter(value, tokenArray);\n\t}\n}\n"],"mappings":"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"}